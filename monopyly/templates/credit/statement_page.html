{% extends 'layout.html' %}


{% block header %}

	<h1>
		{% block title %}
			Statement Details
		{% endblock %}
	</h1>

	<nav id="sidebar-nav-menu">
		<ul>

			<li>
				<a class="action" href="{{ url_for('credit.show_statements') }}">
					<img class="button-icon" src="{{ url_for('static', filename='img/arrow-left.png') }}" />
				</a>
			</li>

			<li>
				<a class="action" href="{{ url_for('credit.new_transaction', statement_id=statement['id']) }}">
					<img class="button-icon" src="{{ url_for('static', filename='img/plus.png') }}" />
				</a>
			</li>

		</ul>
	</nav>

{% endblock %}


{% block content %}

	<div id="statement-details">
		<div id="statement-info">
			<div id="card">
				{{ statement['bank'].upper() }} {{ statement['last_four_digits'] }}
			</div>
			<div id="issue-date">
				{{ statement['issue_date'].strftime('%B %Y') }}
			</div>
			<div id="total">
				<div>$</div>
				<div>{{ '{:,.2f}'.format(statement['total']) }}</div>
			</div>
			<div id="payment">
				<div id="due">
					<div>DUE</div>
					<div id="due-date" class="date">{{ statement['due_date'] }}</div>
					<input id="edit-due-date" class="date" type="text" name="due_date" value="{{ statement['due_date'] }}" size="10" />
					<img id="edit-due-date-icon" src="{{ url_for('static', filename='img/edit.png') }}" />
				</div>
				{% if statement['paid'] %}
					{% if statement['payment_date'] %}
						<div id="paid" class="paid-notice slide-text">
							<div class="sleeve">
								<div class="main">PAID</div>
								<div class="reveal">{{ statement['payment_date'] }}</div>
							</div>
						</div>
					{% else %}
						<div id="paid" class="paid-notice">
							PAID
						</div>
					{% endif %}
				{% else %}
					<form id="pay" action="" method="post">
						<div class="form-line">
							<input id="pay-date" type="text" name="pay_date" />
							<button id="make-payment" class="dark-background" type="button"> 
								<div id="prompt">Pay this statement</div>
								<img class="button-icon" src="{{ url_for('static', filename='img/checkmark.png') }}" />
							</button>
						</div>
					</form>
				{% endif %}
			</div>
		</div>
		
		<table id="statement-transactions" class="transactions">
	
			<tr>
				<th class="date">Date</th>
				<th class="text">Vendor</th>
				<th class="price">Price</th>
				<th class="edit"></th>
			</tr>
	
			{% for transaction in statement_transactions %}
	
				<tr>
					<td class="date">{{ transaction['transaction_date'] }}</td>
					<td class="text">{{ transaction['vendor'] }}</td>
					<td class="price">{{ '${:,.2f}'.format(transaction['price']) }}</td>
					<td>
						<a href="{{ url_for('credit.show_transaction', transaction_id=transaction['id']) }}">
							<img class="more" src="{{ url_for('static', filename='img/plus.png') }}" />
						</a>
					</td>
				</tr>
	
			{% endfor %}	
	
		</table>

	</div>

{% endblock %}


{% block javascript %}

	<script src="{{ url_for('static', filename='js/update_statement_due_date.js') }}">
	</script>
	<script>
		const UPDATE_STATEMENT_DUE_DATE_ENDPOINT = "{{ url_for('credit.update_statement_due_date', statement_id=statement['id']) }}";
	</script>
	<script src="{{ url_for('static', filename='js/update_statement_payment_date.js') }}">
	</script>

{% endblock %}
